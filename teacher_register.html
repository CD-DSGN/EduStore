<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script src="./js/jquery-1.11.3.min.js"></script>
<script src="./js/jquery.form.js"></script>
<script src="./js/teacher_register.js"></script>
<link rel="icon" href="animated_favicon.gif" type="image/gif" />
<link rel="stylesheet" href="./themes/ecmoban_kaola2016/style.css" />
<title>教师注册</title>
</head>
<body style="background-color: ; ">
	<!-- 头部样式 -->
	<div id="register_head" style="">
		<div class="head_logo">
			<a href="./index.php"><img src="./data/images/logo.png" alt="首页图片" width="156px" height="100px" /></a>
		</div>
		<div class="head_text">
			<p>欢迎光临汇师网，请<a href="./user.php" style="color:#7be6b0">登录</a></p>
		</div>
	</div>
	<!-- 注册主体部分 -->
	<div id="body_img">
		<div id="teacher_register" style="display:;">
			<div id="register_status">
				<p>教师注册</p>
				<ul>
					<li><img src="./data/images/register/icon1.png" height="33px" width="26px" id="img_step_one" /><span class="status step_one" style="color:#65bf92;">创建账户</span></li>
					<li><img src="./data/images/register/icon_gray2.png" height="33px" width="26px" id="img_step_two" /><span class="status step_two">身份信息</span></li>
					<li><img src="./data/images/register/icon_gray3.png" height="33px" width="26px" id="img_step_three" /><span class="status step_three">注册成功</span></li>
				</ul>
			</div>
			<div id="register_form">
				<form action="./user.php" method="post" name="formTeacher" style="white-space:nowrap;" id="formTeacher" onsubmit="return register();" >
					<!-- 第一步，创建账户 -->
					<div id="create_account" style="display:block">
						<div>
							<label for="mobileNumber" class="register_info">手机号码</label>
							<input name="mobile_phone_register" type="text" id="mobileNumber" class="register_input" oninput="checkMobileNumber();" onfocus="focusTips(this.id, '请输入手机号码');" onblur="checkMobileNumber();" />
							<span class="correct_input" id="mobileNumber_correct"><img src="./data/images/register/success.png" width="18px" height="18px" alt="correct" /></span>
							<span class="input_tip" id="mobileNumber_tips"></span>
							<span id="mobileNumber_status"></span>
						</div>
						<div>
							<label for="identifyCode" class="register_info">验证码</label>
							<input name="identifyCode" type="text" id="identifyCode" class="identifyCode_input" onblur="checkIdentifyCode();" oninput="checkIdentifyCode()" onfocus="focusTips(this.id, '请输入验证码');" />
							<button class="get_identifyCode" onclick="getIdentifyCode(); return false;">点击获取</button>
							<span class="correct_input_identifyCode" id="identifyCode_correct"><img src="./data/images/register/success.png" width="18px" height="18px" /></span>
							<span class="input_tip" id="identifyCode_tips"></span>
						</div>
						<div>
							<label for="password" class="register_info">密码</label>
							<input type="password" class="register_input" id="password" name="password" onblur="checkPassword();" oninput="checkPassword();" onfocus="focusTips(this.id, '请输入密码')" />
							<span class="correct_input" id="password_correct"><img src="./data/images/register/success.png" width="18px" height="18px" alt="correct" /></span>
							<span class="input_tip" id="password_tips"></span>
						</div>
						<div>
							<label for="confirm_password" class="register_info">确认密码</label>
							<input type="password" class="register_input" id="confirm_password" name="confirm_password" onblur="checkConfirmPassword();" oninput="checkConfirmPassword();" onfocus="focusTips(this.id, '请再次输入密码');" />
							<span class="correct_input" id="confirm_password_correct"><img src="./data/images/register/success.png" width="18px" height="18px" alt="correct" /></span>
							<span class="input_tip" id="confirm_password_tips"></span>
						</div>
						<div>
							<label for="invite_code" class="register_info">邀请码<span style="font-size:11px">（选填）</span></label>
							<input type="text" class="register_input" id="invite_code" name="invite_code" onblur="check_invite_code();" onfocus="focusTips(this.id, '请输入邀请码')"/>
							<span class="correct_input" id="invite_code_correct"><img src="./data/images/register/success.png" width="18px" height="18px" alt="correct" /></span>
							<span class="input_tip" id="invite_code_tips"></span>
						</div>
						<div style="margin-left:322px; line-height:50px;">
							<input type="checkbox" name="agreement" id="agreement" checked="checked" value="1" onblur="checkAgreement();">
							<span>我已看过并接受<a href="" style="color:green;">《用户协议》</a></span>
							<span class="agreement_tip" id="agreement_tips"></span>
						</div>
						<div>
							<button class="next_step" id="next" onclick="nextStep(); return false;">
								下一步
							</button>
						</div>
					</div>
					<!-- 第二步，完善信息 -->
					<div id="improve_info" style="display: none;">
						<div>
							<label for="real_name" class="register_info">教师姓名</label>
							<input type="text" class="register_input" id="real_name" name="real_name" onblur="checkRealName();" onfocus="focusTips(this.id, '请输入您的姓名')" />
							<span class="correct_input" id="real_name_correct"><img src="./data/images/register/success.png" width="18px" height="18px" alt="correct" /></span>
							<span class="input_tip" id="real_name_tips"></span>
						</div>
						<div>
								<label class="register_info" style="margin-right:22px;">所在区域</label>
									<select name="province" id="province" class="select_button1" onblur="checkAddressName();" onmouseup="checkAddressName();" style="background-color:#fff ">
										<option value="0">请选择省</option>
									</select>
									<select name="city" id="city" class="select_button1" onblur="checkAddressName();" onmouseup="checkAddressName();" style="background-color:#fff ">
										<option value="0">请选择市</option>
									</select>
									<select name="district" id="town" class="select_button1" onblur="checkAddressName();" onmouseup="checkAddressName();" style="background-color:#fff ">
										<option value="0">请选择县/区</option>
									</select>
									<!-- modify nhj, 选择地区成功不显示 -->
<!-- 								<span class="correct_select" id="address_correct"><img src="./data/images/register/success.png" width="18px" height="18px" alt="correct" /></span> -->
								<span class="input_tip" id="address_notice"></span>
						</div>
						<div>
							<label for="school" class="register_info" style="margin-right: 22px;">学校</label>
							<!-- <input type="text" class="register_input" id="school" name="school" onblur="checkSchool();" onfocus="focusTips(this.id, '请输入您的学校')" /> -->
							<select name="teacher_school" id="school" class="select_button1" style="width: 250px; font-size: 14px;background-color:#fff " onblur="checkSchool()" onmouseup="checkSchool();showAll()">
								<option value="0">请选择学校</option>
							</select>
							<span class="correct_input" id="school_correct"><img src="./data/images/register/success.png" width="18px" height="18px" alt="correct" /></span>
							<span class="input_tip" id="school_tips"></span>
						</div>
						<div>
							<label for="course_name" class="register_info">任课课程</label>
							<div class="select_background" style=" position: absolute; width: 140px; height: 42px; display: inline-block; left: 115px; background: url('./data/images/register/select.png') no-repeat 110px; border: 2px solid #d3d3d3; border-radius: 6px;">
							<div id="select_hide" style=" position: absolute; width: 110px; height: 35px; display: inline-block; top: 2px; overflow: hidden;  ">
							<select name="course_name" id="course_name" class="select_button" onblur="checkCourseName()" onmouseup="checkCourseName();showAll()" style="background-color:#fff ">
								<option value="0">请选择课程</option>
							</select>
							</div>
							</div>
							<span class="correct_select1" id="select_correct"><img src="./data/images/register/success.png" width="18px" height="18px" alt="correct" /></span>
							<span class="input_tip" id="course_name_tips"></span>
						</div>
						<div class="gradeAndClass">
							<label for="grade" class="register_info" style="margin-right: 22px;">年级</label>

							<select name="" id="" class="select_button1 grade" style="width: 120px; font-size: 14px;background-color: #fff;" onblur="checkGradeClass()" onmouseup="checkGradeClass();showAll()">
								<option value="0">请选择年级</option>
							</select>
							<label for="school_class" class="register_info" style="width: 50px;">班级</label>
							<input type="text" class="register_input school_class" style="width: 60px; font-size: 14px;" id="" name="" onblur="checkGradeClass()" oninput="checkGradeClass();showAll()" onfocus="" onchange="showAll()" />
                            <span class="class_span">班</span>
							<span class="more_button" id="more" onclick="appendGradeAndClass();"><img src="./data/images/register/more_button.png" alt="" width="30px" height="30px" /></span>
							<!-- 用來提示的字 -->
							<span class="input_tip grade_class_tips" id=""></span> 
						</div>
						<div>
							<input type="hidden" name="is_teacher" value="1">
							<input name="act" type="hidden" value="act_register" >
							<input type="submit" name="" value="会员注册" class="register" id="submit" >
						</div>
					</div>
					<!-- 第三步，注册成功 -->
					<div id="register_success" style="display:none">
						<div>
							<img src="./data/images/register/success.png" width="38px" height="38px">
						</div>
						<div style="font-size:30px; color:#353032;">
							恭喜您，注册成功！
						</div>
						<div>
							<button class="buy_now_button" onclick="jumpToIndex()">立即购物</button>
						</div>
						<div style="font-size:14px; color:#353032; line-height: 40px;">
							<span id="goIndex">3</span>秒后自动返回......
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- 商城底部 -->
	<div class="foot_blank" style="width:1920px; height: 150px; background-color: #f9f9f9;"></div>
	<div id="foot">
		<p>©Copyright 2016 汇师网 All Right Reserved 成都大术光年信息技术有限公司</p>
	</div>
</body>
<script type="text/javascript">
	// 定义全局变量，保存所有的年级信息
	var grade; 
	$(document).ready(function() {
		$("#next").hover(function() {
						$(this).css({'background-color' : '#e65d22', 'border' : '2px solid #e65d22'});
					},function() {
						$(this).css({'background-color' : '#ff6825', 'border' : '2px solid #ff6825'});
					}
		);
		$("#submit").hover(function() {
						$(this).css({'background-color' : '#ff6825', 'color' : '#fdfdfd'});
					}, function() {
						$(this).css({'background-color' : '#fdfdfd', 'color' : '#ff6825'});
					}
		);
		$(".buy_now_button").hover(function() {
								$(this).css({'background-color' : '#e65d22', 'border' : '2px solid #e65d22'});
							}, function() {
								$(this).css({'background-color' : '#ff6825', 'border' : '2px solid #ff6825'});
							});
		$.ajaxSetup({   
            async : false  
        });
		//ajax查询省市县
		$.post('user.php?act=get_province',
				{},
				function(msg){
					var province = msg.province.split('@');
					var province_option = msg.province_option.split('@');
					for (var i=0;i<province.length;i++){
						$("#province").append('<option value='+province_option[i]+'>'+province[i]+'</option>');
					}
				},"json"
			);
        // ajax 查询课程，并增加到option中
        $.post('./user.php?act=get_course',
        		{},
        		function(data) {
        			var dataObj = eval("("+data+")");
        			$.each(dataObj, function(name, item)
        			{
        				$("#course_name").append('<option value='+item.course_id+'>'+item.course_name+'</option>');
        			});
        			// var course_info = data.split('@');
        			// for (var i = 0; i < course_info.length; i++) {
        			// 	var temp = i + 1;
        			// 	$("#course_name").append('<option value='+temp+'>'+course_info[i]+'</option>');
        			// }
        		}
        );
        // ajax 查询所有的年级
        $.post('./user.php?act=get_grade',
        		{},
        		function(data) {
        			var dataObj = eval("("+data+")");
        			// console.log(dataObj);
        			grade = dataObj;
        			$.each(dataObj, function(name, item)
        			{
        				$(".grade").append('<option value='+item.grade_id+'>'+item.grade_name+'</option>');
        			});
        		}
        );
	});

	$("#province").change(function(){
			var province = $("#province").val();
			$("#city").empty("option");
			$("#city").prepend("<option value='0'>请选择市</option>");
			if(province != 0){
				$.ajax({
					type:"POST",
					url:"user.php?act=get_city",
					data:"province="+province,
					dataType:"json",
					success:function(msg){
						var city = msg.city.split('@');
						var city_option = msg.city_option.split('@');
						for (var i=0;i<city.length;i++){
							$("#city").append('<option value='+city_option[i]+'>'+city[i]+'</option>');
						}
					}
				});
			}
			else{
				$("#city").empty("option");
				$("#city").append("<option value='0'>请选择市</option>");
			}
		});
		$("#city").change(function(){
			var city = $("#city").val();
			$("#town").empty("option");
			$("#town").append("<option value='0'>请选择县/区</option>");
			if(city != 0){
				$.ajax({
					type:"POST",
					url:"user.php?act=get_town",
					data:"city="+city,
					dataType:"json",
					success:function(msg){
						var town = msg.town.split('@');
						var town_option = msg.town_option.split('@');
						for (var i=0;i<town.length;i++){
							$("#town").append('<option value='+town_option[i]+'>'+town[i]+'</option>');
						}
					}
				});
			}
			else{
				$("#town").empty("option");
				$("#town").append("<option value='0'>请选择县/区</option>");
			}
		});
		$("#town").change(function() {

				$("#school").empty("option");
				$("#school").append("<option value='0'>请选择学校</option>");
				var district = $("#town").val();
				if (district != 0) {

					// ajax 获取学校信息
					$.ajax({
						type : "POST",
						url : "user.php?act=get_school",
						data : "district=" + district,
						dataType : "json",
						success : function(msg) {

							console.log(msg);
							var school_name = msg.school_name.split('@');
							var school_id = msg.school_id.split('@');
							console.log(school_name);
							for (var i = 0; i < school_name.length; i++) {

								$("#school").append('<option value='+school_id[i]+'>'+school_name[i]+'</option>');
							}
						}
					});
				} else {

					$("#school").empty("option");
					$("#school").append("<option value='0'>请选择学校</option>");
				}
			}
		);
</script>
<script type="text/javascript">
	function register() {
		if( realName_status != 1) {
			$("#real_name").focus().select();
			$("#real_name_correct").css({'display':'none'});
			$("#real_name_tips").html(error_info + '教师姓名不能为空');
			return false;
		}else if(address_status !=1){
			$("#province").focus().select();
			$("#address_notice").html(error_info + "请选择所在地");
			return false;
		}else if( school_status != 1) {
			$("#school").focus().select();
			$("#school_correct").css({'display':'none'});
			$("#school_tips").html(error_info + '学校不能为空');
			return false;
		}else if(course_status != 1) {
			$("#course_name").focus().select();
			$("#select_correct").css({'display':'none'});
			$("#course_name_tips").html(error_info + '请选择课程');
			return false;
		}else if(grade_class_status != 1) {
			var gradeClassTips = $(".grade_class_tips");
			var grade = $(".grade");
			for (var i = 0; i < gradeClassTips.length; i++) {
				$(gradeClassTips[i]).html('');
			}

			$(gradeClassTips[gradeClassTips.length - 1]).html(error_info + '年级与班级不能为空');

			$(grade[grade.length - 1]).focus().select();
			// 注意顺序，体验好
			if (grade_class_status == 0) {
				$(gradeClassTips[gradeClassTips.length - 1]).html(error_info + '请至少填写一组年级和班级');
			} else if (grade_class_status == 3) {
				$(gradeClassTips[gradeClassTips.length - 1]).html(error_info + '年级和班级要么都填，要么都不填');
			} else if (grade_class_status == 2) {
				$(gradeClassTips[gradeClassTips.length - 1]).html(error_info + '班级只能填写数字');
			}
			return false;
		}else {
			var teacher_grade = gradeArray.join('@');
			var teacher_class = classArray.join('@');
			// var teacher_grade = JSON.stringify(gradeArray);
			// var teacher_class = JSON.stringify(classArray);
			$("#formTeacher").ajaxSubmit({
				type : 'post',
				url : 'user.php?act=act_register',
				data : {'teacher_grade' : teacher_grade,
						'teacher_class' : teacher_class},
				traditional : true,
	    		success : function() {
	    			$(".step_two").css({'color' : '#666'});
					$("#img_step_two").attr({'src' : './data/images/register/icon_gray2.png'});
					$(".step_three").css({'color' : '#65bf92'});
					$("#img_step_three").attr({'src' : './data/images/register/icon3.png'});
					$("#register_success").css({'display' : ''});
					$("#improve_info").css({'display' : 'none'});
					var count = 2;
					var countDownIndex = setInterval(function() {
						$("#goIndex").html(count);
						count--;
						if(count == -1) {
							clearInterval(countDownIndex);
							//最后修改为网站首页域名
							window.location.href = './';
						}
					}, 1000) 


	    		},
	    		error : function() {
	    			alert("网络连接失败，请检查网络。");
	    		},
	    		timeout : 5000
	    	});
		}
		return false;
}

function appendGradeAndClass()
{
	// 动态增加的html文件
	var content = "<div class=\"gradeAndClass\">" + 
							"<label for=\"grade\" class=\"register_info\" style=\"margin-right: 26px;\">年级</label>" +
							"<select name=\"\"  class=\"select_button1 grade\" style=\"width: 120px; font-size: 14px\" onblur=\"checkGradeClass()\" onmouseup=\"checkGradeClass();showAll()\">" +
								"<option value=\"0\">请选择年级</option>" +
							"</select>" +
							"<label for=\"school_class\" class=\"register_info\" style=\"width: 54px;\">班级</label>" +
							"<input type=\"text\" class=\"register_input school_class\" style=\"width: 60px; font-size: 14px; margin-left: 24px;\" name=\"\" onblur=\"checkGradeClass()\" oninput=\"checkGradeClass();showAll()\" onfocus=\"\" />" +
							"<span class=\"class_span\" style=\"left: -16px;\">班</span>" +
							"<span class=\"more_button\" style=\"left: 8px;\" onclick=\"appendGradeAndClass();\"><img src=\"./data/images/register/more_button.png\" alt=\"\" width=\"30px\" height=\"30px\" /></span>" +
							"<span class=\"input_tip grade_class_tips\" id=\"\"></span>" +
						"</div>";
	// 增加html文件
	var gradeAndClass = $(".gradeAndClass");
	gradeAndClass = gradeAndClass[gradeAndClass.length - 1];
	$(gradeAndClass).after(content);
	// 为增加的select赋值
	var gradeClass = $(".grade");
	gradeClass = gradeClass[gradeClass.length - 1];
	$.each(grade, function(name, item)
    {
        $(gradeClass).append('<option value='+item.grade_id+'>'+item.grade_name+'</option>');
    });
    // 只保留最后一个more_button按钮
    var moreButtonClass = $(".more_button");
    if (moreButtonClass.length == 5) {
    	$(moreButtonClass[moreButtonClass.length - 2]).css({'display' : 'none'});
    	$(moreButtonClass[moreButtonClass.length - 1]).css({'display' : 'none'});
    } else {
    	$(moreButtonClass[moreButtonClass.length - 2]).css({'display' : 'none'});
    }
    // 调整背景及所涉及内容的高度
    if (moreButtonClass.length > 3) {
    	var foot_blank_height = 150 + parseInt(80 * (moreButtonClass.length - 3));
	    $(".foot_blank").css({'height' : foot_blank_height + 'px',});
	    var teacher_register_height = 800 + parseInt(80 * (moreButtonClass.length - 3));
	    $("#teacher_register").css({'height' : teacher_register_height + 'px'});
    }
}


</script>
</html>


